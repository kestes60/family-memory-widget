# Testing Guide for Family Memory Widget

This guide will help you test the new Pro features: **Download Recording** and **Export PDF**.

## Prerequisites

1. A modern browser (Chrome, Firefox, Safari, or Edge)
2. Microphone access (widget will request permission)
3. HTTPS or localhost environment (required for MediaRecorder API)

## Quick Start

### Step 1: Start Local Server

Since the MediaRecorder API requires HTTPS or localhost, start a local server:

```bash
cd /home/keith_yahtsar/code/family-memory-widget

# Python 3 (recommended)
python3 -m http.server 8000

# Then open: http://localhost:8000
```

### Step 2: Open Demo Page

Open `http://localhost:8000` in your browser.

## Testing Free Tier (Default)

1. **Record Audio**
   - Click the purple microphone button
   - Allow microphone access when prompted
   - Speak for a few seconds (test message: "This is a family memory test")
   - Watch the progress bar count down from 2:00
   - Click mic again to stop, or let it auto-stop at 2:00

2. **View Transcript**
   - After recording stops, you'll see "Transcribing your memory..."
   - Wait for the transcript to appear (usually 5-15 seconds)
   - **Expected**: You'll see the Pro upgrade hint at the top

3. **Test Free Tier Buttons**
   - **Close**: Closes modal ‚úÖ
   - **Download Recording (Pro)**: Button is visible but disabled/grayed out
     - Clicking it shows "Pro Feature Required" modal ‚úÖ
   - **Export PDF**: Button is NOT visible in free tier ‚úÖ
   - **Copy Text**: Copies transcript to clipboard ‚úÖ

4. **Test Rate Limiting**
   - Make 3 recordings in a row
   - On the 4th attempt, you should see "Daily limit reached" message ‚úÖ
   - To reset: Open browser console and run: `localStorage.clear()`

## Testing Pro Tier

### Step 1: Enable Pro Mode

In the demo page, you'll see a toggle switch at the top:

```
üß™ Testing Mode
Free Mode [TOGGLE SWITCH] Pro Mode ‚≠ê
```

1. Click the toggle to enable Pro mode
2. Alert will appear: "‚úÖ Pro mode enabled!"
3. Page will reload automatically

### Step 2: Test Pro Features

1. **Record Another Audio**
   - Click the mic button
   - Record a short message
   - Notice the progress bar now goes to 5:00 (5 minutes) instead of 2:00

2. **Download Recording**
   - After transcription completes, look for "üì• Download Recording" button
   - Button should be ENABLED (not grayed out)
   - Click it
   - **Expected**: 
     - File downloads as `family-memory-YYYY-MM-DDTHH-MM-SS.wav`
     - Button changes to "‚úÖ Downloaded!" briefly
   - Check your Downloads folder for the file ‚úÖ

3. **Export PDF**
   - Look for "üìÑ Export PDF" button (only visible in Pro mode)
   - Click it
   - **Expected**:
     - PDF downloads as `family-memory-YYYY-MM-DD.pdf`
     - Button changes to "‚úÖ Exported!" briefly
   - Open the PDF and verify it contains:
     - Title: "Family Memory Transcript"
     - Date/timestamp
     - Language detected
     - Confidence score
     - Duration
     - Full transcript text
     - Footer: "Generated by Family Memory Widget"
   ‚úÖ

4. **Test Unlimited Recording**
   - Make 5+ recordings in a row
   - **Expected**: No rate limit message (unlimited for Pro) ‚úÖ

5. **Edit Transcript Before Export**
   - Record audio
   - In the modal, edit the transcript text
   - Click "Export PDF"
   - Open PDF and verify it has your EDITED text (not original) ‚úÖ

## Troubleshooting

### Microphone Not Working
- **Chrome**: Make sure you're on `localhost` or `https://`
- **Safari**: Check Settings ‚Üí Websites ‚Üí Microphone permissions
- **Firefox**: Click the microphone icon in address bar

### API Transcription Fails
- Check browser console (F12) for error messages
- Verify the API endpoint is accessible:
  ```
  https://faster-whisper-api-production-537b.up.railway.app/transcribe-audio
  ```
- If API is down, you'll see error modal with details

### PDF Export Not Working
- Check browser console for errors
- Verify jsPDF is loaded: Open console and type `window.jspdf`
  - Should return an object, not `undefined`
- Make sure the script tag is in your HTML:
  ```html
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  ```

### Download Not Working
- Check browser download settings (pop-up blockers, etc.)
- Try a different browser
- Check console for errors

### Pro Mode Not Persisting
- Check localStorage: Open console and type:
  ```javascript
  localStorage.getItem('familyMemory_pro')
  ```
- Should return `"true"` when Pro is enabled
- To manually enable Pro:
  ```javascript
  localStorage.setItem('familyMemory_pro', 'true')
  window.location.reload()
  ```

## Test Checklist

### Free Tier ‚úì
- [ ] Record audio (2 min limit)
- [ ] View transcript in modal
- [ ] Edit transcript text
- [ ] Copy transcript to clipboard
- [ ] See Pro upgrade hints
- [ ] Rate limiting works (3 per day)
- [ ] Download button is disabled/grayed
- [ ] PDF export button is hidden

### Pro Tier ‚úì
- [ ] Toggle Pro mode ON
- [ ] Record audio (5 min limit)
- [ ] No rate limiting
- [ ] Download button is enabled and works
- [ ] Audio file downloads with correct filename
- [ ] PDF export button is visible
- [ ] PDF downloads with correct filename
- [ ] PDF contains all metadata
- [ ] PDF includes edited transcript text
- [ ] No Pro upgrade hints shown

## Console Commands (Helpful for Testing)

```javascript
// Check current Pro status
localStorage.getItem('familyMemory_pro')

// Enable Pro mode manually
localStorage.setItem('familyMemory_pro', 'true')
window.location.reload()

// Disable Pro mode
localStorage.removeItem('familyMemory_pro')
window.location.reload()

// Reset rate limiting
const usage = JSON.parse(localStorage.getItem('familyMemory_usage'))
console.log('Current usage:', usage)
localStorage.removeItem('familyMemory_usage')

// Clear everything
localStorage.clear()

// Check what's stored
for (let i = 0; i < localStorage.length; i++) {
  const key = localStorage.key(i)
  console.log(key, '=', localStorage.getItem(key))
}
```

## Known Limitations

1. **Audio format**: Downloads as WebM (browser native format), not true WAV
   - Filename says `.wav` but actual format is whatever MediaRecorder produces
   - To convert to true WAV, you'd need a library like `lamejs` or server-side conversion

2. **Client-side rate limiting**: Easy to bypass by clearing localStorage
   - For production, implement server-side rate limiting

3. **No authentication**: Pro status is just a localStorage flag
   - For production, verify Pro status via backend API

4. **No cloud storage**: Recordings and transcripts are not persisted
   - Everything is client-side only

## Success Criteria

All features work correctly when:
- ‚úÖ Free users see disabled download button with upgrade prompt
- ‚úÖ Free users don't see PDF export button
- ‚úÖ Pro users can download recordings with timestamp filename
- ‚úÖ Pro users can export formatted PDFs
- ‚úÖ PDFs include all metadata and transcript
- ‚úÖ Rate limiting works in free tier but not Pro tier
- ‚úÖ Pro mode persists across page reloads (until disabled)

---

Happy testing! üéâ

If you find any bugs or issues, check the browser console first, then review the troubleshooting section above.

